---
# ==============================================================================
# Environment metadata
# ==============================================================================
env: dev
project: levendaal
layer: base-vms-hardening

# ==============================================================================
# VM Hardening
# ==============================================================================

# SSH key storage base directory
vm_keys_base_dir: /home

# Management network CIDR (used for SSH firewall source restriction)
management_network: 192.168.122.0/24

# ==============================================================================
# Administrative user (created via cloud-init during provisioning)
# ==============================================================================
admin_user: ansible
admin_user_groups:
  - sudo

# Restrict SSH login to admin user only (overrides ssh-hardening role default)
ssh_allow_users: "{{ admin_user }}"

# Only ed25519 + rsa host keys exist (cloud-init doesn't generate ecdsa)
ssh_host_key_files:
  - /etc/ssh/ssh_host_rsa_key
  - /etc/ssh/ssh_host_ed25519_key

# ==============================================================================
# Firewall â€” restrict SSH to management network (overrides os-hardening default)
# ==============================================================================
ufw_rules:
  - rule: allow
    port: 22
    proto: tcp
    from_ip: "{{ management_network }}"
    comment: 'SSH access (management network only)'

ufw_egress_rules:
  - rule: allow
    port: 53
    proto: udp
    comment: 'DNS'
  - rule: allow
    port: 53
    proto: tcp
    comment: 'DNS over TCP'
  - rule: allow
    port: 123
    proto: udp
    comment: 'NTP'
  - rule: allow
    port: 80
    proto: tcp
    comment: 'HTTP (apt updates)'
  - rule: allow
    port: 443
    proto: tcp
    comment: 'HTTPS (apt updates)'
